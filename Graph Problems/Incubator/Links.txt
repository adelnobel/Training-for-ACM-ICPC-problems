This is a (Transitive disclosure problem & BITMASKING bruteforce, one of Warshall's applications)

http://community.topcoder.com/stat?c=problem_statement&pm=12196&rd=15179